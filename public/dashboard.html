<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bloom Together - Health Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"></script>
    <style>
      :root {
        --primary: #e91e63; /* Professional pink */
        --primary-light: #f8bbd0; /* Soft pastel pink */
        --primary-dark: #c2185b; /* Deep elegant pink */
        --secondary: #9e9e9e; /* Neutral gray */
        --accent: #ff80ab; /* Light pink accent */
        --background: #fdf7fa; /* Soft pinkish-white */
        --card-bg: rgba(
          255,
          255,
          255,
          0.95
        ); /* White with slight transparency */
        --text: #4a4a4a; /* Dark pinkish-gray for readability */
        --light-text: #a0aec0; /* Soft muted gray */
        --border: #f8bbd0; /* Light pink border */
        --success: #28a745; /* Soft green */
        --warning: #ffb703; /* Gold yellow */
        --danger: #dc3545; /* Red for errors */
        --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.08);
        --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.08);
        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      body {
        font-family: "Inter", system-ui, -apple-system, sans-serif;
        background: linear-gradient(135deg, var(--background), #f1f5f9);
        color: var(--text);
        margin: 0;
        padding: 0;
        min-height: 100vh;
        line-height: 1.6;
      }

      .container {
        display: flex;
        width: 100%;
        position: relative;
        overflow-x: hidden;
      }

      .sidebar {
        width: 200px;
        background: linear-gradient(180deg, #1e293b, #0f172a);
        color: #fff;
        padding: 2rem;
        height: 100vh;
        position: fixed;
        left: 0;
        top: 0;
        transition: var(--transition);
        z-index: 50;
        backdrop-filter: blur(10px);
      }

      .sidebar h2 {
        margin-bottom: 2rem;
        font-size: 1.5rem;
        font-weight: 600;
        background: linear-gradient(
          135deg,
          var(--primary-light),
          var(--accent)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .sidebar ul {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .sidebar li {
        padding: 1rem;
        margin: 0.5rem 0;
        cursor: pointer;
        border-radius: 0.5rem;
        transition: var(--transition);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .sidebar li:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateX(5px);
      }

      .main-content {
        flex-grow: 1;
        padding: 2rem;
        margin-left: 280px;
        transition: var(--transition);
      }

      .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding: 1.5rem;
        background: var(--card-bg);
        border-radius: 1rem;
        box-shadow: var(--shadow);
        backdrop-filter: blur(10px);
      }

      .top-bar h1 {
        background: linear-gradient(135deg, var(--primary), var(--accent));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-size: 1.8rem;
        font-weight: 700;
        margin: 0;
      }

      .notification-badge {
        background-color: var(--primary);
        color: white;
        border-radius: 50%;
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        margin-left: 5px;
      }

      .card {
        background: var(--card-bg);
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow);
        transition: var(--transition);
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
      }

      .card:hover {
        transform: translateY(-2px);
        box-shadow: var(--shadow-lg);
      }

      .card-title {
        font-size: 1.5rem;
        margin-bottom: 20px;
        color: var(--primary);
      }

      .pdf-upload-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 30px;
        border: 2px dashed var(--light-text);
        border-radius: 8px;
        text-align: center;
        cursor: pointer;
      }

      .upload-icon {
        font-size: 3rem;
        margin-bottom: 10px;
      }

      .upload-button {
        background-color: var(--primary);
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 20px;
      }

      .upload-input {
        display: none;
      }

      .dashboard-layout {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 20px;
      }

      .column {
        display: flex;
        flex-direction: column;
      }

      .chart-container {
        padding: 1rem;
        border-radius: 1rem;
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        transition: var(--transition);
        height: 300px;
      }

      .chart-container:hover {
        transform: scale(1.01);
      }

      .vitals-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .vital-card {
        background: var(--card-bg);
        border-radius: 1rem;
        padding: 1.5rem;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
      }

      .vital-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        opacity: 0;
        transition: var(--transition);
      }

      .vital-card:hover {
        transform: translateY(-3px);
        box-shadow: var(--shadow-lg);
      }

      .vital-card:hover::before {
        opacity: 1;
      }

      .vital-value {
        font-size: 2rem;
        font-weight: 600;
        color: var(--primary);
        margin: 0.5rem 0;
        transition: var(--transition);
      }

      .vital-card:hover .vital-value {
        transform: scale(1.1);
      }

      .vital-icon {
        width: 3rem;
        height: 3rem;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(
          135deg,
          var(--primary-light),
          var(--primary)
        );
        border-radius: 1rem;
        color: white;
        font-size: 1.5rem;
        margin-bottom: 1rem;
      }

      .vital-data {
        flex-grow: 1;
      }

      .vital-label {
        font-weight: bold;
        margin-bottom: 5px;
      }

      .vital-status {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.875rem;
        font-weight: 500;
        margin-top: 0.5rem;
      }

      .vital-status.normal {
        background: rgba(34, 197, 94, 0.1);
        color: var(--success);
      }

      .vital-status.warning {
        background: rgba(234, 179, 8, 0.1);
        color: var(--warning);
      }

      .vital-status.danger {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
      }

      .diagnostics-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        margin-top: 1rem;
      }

      .diagnostics-table th {
        background: rgba(255, 255, 255, 0.5);
        padding: 1rem;
        font-weight: 600;
        text-align: left;
        border-bottom: 2px solid var(--border);
      }

      .diagnostics-table td {
        padding: 1rem;
        border-bottom: 1px solid var(--border);
      }

      .status-pill {
        display: inline-flex;
        align-items: center;
        padding: 0.375rem 0.75rem;
        border-radius: 2rem;
        font-size: 0.875rem;
        font-weight: 500;
        gap: 0.5rem;
      }

      .status-observation {
        background: rgba(14, 165, 233, 0.1);
        color: var(--primary);
      }

      .status-ongoing {
        background: rgba(34, 197, 94, 0.1);
        color: var(--success);
      }

      .patient-profile {
        text-align: center;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.5s ease-out;
        display: none;
      }

      .patient-profile.show {
        opacity: 1;
        transform: translateY(0);
        display: block;
      }

      .empty-state {
        text-align: center;
        padding: 2rem;
        color: var(--light-text);
      }

      .empty-state-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        color: var(--primary-light);
      }

      .empty-state-text {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
      }

      .empty-state-subtext {
        font-size: 0.9rem;
        opacity: 0.8;
      }

      .profile-avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background-color: #e9f5fe;
        margin: 0 auto 15px;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 48px;
        color: var(--primary);
      }

      .profile-name {
        margin-bottom: 20px;
      }

      .patient-details-list {
        text-align: left;
      }

      .detail-item {
        display: flex;
        align-items: center;
        margin-bottom: 10px;
      }

      .detail-icon {
        font-size: 1.2rem;
        margin-right: 10px;
      }

      .detail-content {
        flex-grow: 1;
      }

      .detail-label {
        font-weight: bold;
        margin-bottom: 3px;
      }

      .lab-results-list {
        display: flex;
        flex-direction: column;
      }

      .lab-result-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px;
        border-bottom: 1px solid var(--border);
      }

      .download-icon {
        cursor: pointer;
        color: var(--primary);
      }

      /* Chart.js Customizations */
      .chart-container canvas {
        width: 100% !important;
        height: 100% !important;
      }

      .chart-legend {
        display: flex;
        justify-content: center;
        margin-bottom: 10px;
      }

      .chart-legend .legend-item {
        display: flex;
        align-items: center;
        margin: 0 10px;
      }

      .chart-legend .legend-color {
        width: 20px;
        height: 10px;
        border-radius: 5px;
        margin-right: 5px;
      }

      .chart-legend .systolic {
        background-color: var(--primary);
      }

      .chart-legend .diastolic {
        background-color: var(--accent);
      }

      .show-all-btn {
        color: var(--primary);
        cursor: pointer;
        margin-top: 15px;
        font-weight: 500;
      }

      .pdf-preview {
        width: 100%;
        max-height: 300px;
        border: 1px solid var(--border);
        border-radius: 8px;
        overflow: hidden;
        margin-top: 20px;
      }

      .tooltips {
        position: absolute;
        background-color: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 4px;
        padding: 10px;
        font-size: 14px;
        box-shadow: var(--shadow);
        z-index: 100;
        display: none;
      }

      .analytics-badge {
        display: inline-block;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
        margin-left: 8px;
      }

      .analytics-badge.improving {
        background-color: #e8f5e9;
        color: #4caf50;
      }

      .analytics-badge.worsening {
        background-color: #ffebee;
        color: #f44336;
      }

      .notification {
        position: fixed;
        top: 1.5rem;
        right: 1.5rem;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
        color: white;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transform: translateX(120%);
        z-index: 1000;
        box-shadow: var(--shadow-lg);
        opacity: 0;
        transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        font-size: 0.875rem;
        font-weight: 500;
        backdrop-filter: blur(8px);
        max-width: 300px;
      }

      .notification svg {
        width: 18px;
        height: 18px;
        flex-shrink: 0;
      }

      .notification.show {
        transform: translateX(0);
        opacity: 1;
      }

      .notification.success {
        background: linear-gradient(
          135deg,
          rgba(34, 197, 94, 0.95),
          rgba(5, 150, 105, 0.95)
        );
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .notification.error {
        background: linear-gradient(
          135deg,
          rgba(239, 68, 68, 0.95),
          rgba(220, 38, 38, 0.95)
        );
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* Enhanced Mobile Responsiveness */
      @media (max-width: 1024px) {
        .sidebar {
          width: 220px;
        }

        .main-content {
          margin-left: 220px;
        }

        .dashboard-layout {
          grid-template-columns: 1fr;
        }

        .vitals-grid {
          grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
      }

      @media (max-width: 768px) {
        .sidebar {
          transform: translateX(-100%);
          width: 100%;
          max-width: 300px;
        }

        .sidebar.active {
          transform: translateX(0);
        }

        .main-content {
          margin-left: 0;
          padding: 1rem;
        }

        .top-bar {
          flex-direction: column;
          gap: 1rem;
          text-align: center;
          padding: 1rem;
        }

        .vitals-grid {
          grid-template-columns: 1fr;
          gap: 1rem;
        }

        .card {
          padding: 1rem;
        }

        .notification {
          top: 1rem;
          right: 1rem;
          left: 1rem;
          width: calc(100% - 2rem);
          max-width: none;
          padding: 0.625rem 0.875rem;
          font-size: 0.8125rem;
        }
      }

      /* Dark Mode Enhancements */
      @media (prefers-color-scheme: dark) {
        :root {
          --background: #0f172a;
          --card-bg: rgba(30, 41, 59, 0.95);
          --text: #f1f5f9;
          --light-text: #94a3b8;
          --border: #334155;
        }

        .sidebar {
          background: linear-gradient(180deg, #0f172a, #020617);
        }

        .card,
        .vital-card {
          border-color: rgba(255, 255, 255, 0.05);
        }

        .diagnostics-table th {
          background: rgba(0, 0, 0, 0.2);
        }
      }

      .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        backdrop-filter: blur(8px);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 9999;
        color: white;
      }

      .loading-text {
        text-align: center;
        margin: 2rem 0;
      }

      .loading-text h3 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        background: linear-gradient(
          135deg,
          var(--primary-light),
          var(--accent)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .loading-text p {
        font-size: 1rem;
        color: rgba(255, 255, 255, 0.8);
        margin: 0.25rem 0;
        transition: all 0.3s ease;
      }

      .progress-bar-container {
        width: 300px;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        overflow: hidden;
        margin-top: 1rem;
      }

      .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        width: 0;
        transition: width 0.5s ease;
        border-radius: 3px;
        position: relative;
      }

      .progress-bar::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 1.5s infinite;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-radius: 50%;
        border-top-color: var(--primary);
        animation: spin 1s ease-in-out infinite;
        margin-bottom: 1rem;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 0.75rem;
        background: rgba(255, 255, 255, 0.1);
        transition: var(--transition);
      }

      .user-info:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .user-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          var(--primary-light),
          var(--primary)
        );
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1rem;
      }

      .user-name {
        font-size: 0.9rem;
        font-weight: 500;
        opacity: 0;
        transform: translateX(-10px);
        transition: all 0.3s ease;
      }

      .user-name.show {
        opacity: 1;
        transform: translateX(0);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="sidebar">
        <h2>Bloom Together</h2>
        <ul>
          <li>Dashboard</li>
          <li>Patients</li>
          <li>Reports</li>
          <li>Analytics</li>
          <li>Settings</li>
        </ul>
      </div>

      <div class="main-content">
        <div class="top-bar">
          <h1>Patient Dashboard</h1>
          <div class="user-info">
            <div class="user-icon">üë§</div>
            <div class="user-name" id="header-user-name">Guest User</div>
          </div>
        </div>

        <div class="card">
          <div class="card-title">Patient Data Import</div>
          <div class="pdf-upload-container" id="upload-container">
            <div class="upload-icon">üìÑ</div>
            <div class="upload-text">
              <p>Upload patient records PDF to automatically extract data</p>
              <p style="font-size: 12px; color: var(--light-text)">
                Supported formats: PDF
              </p>
            </div>
            <label for="pdf-upload" class="upload-button">Choose File</label>
            <input
              type="file"
              id="pdf-upload"
              class="upload-input"
              accept=".pdf"
            />
          </div>
          <div
            id="upload-status"
            style="margin-top: 15px; text-align: center; display: none"
          >
            <p style="color: var(--primary); font-weight: 500">
              Processing PDF data...
            </p>
            <div
              style="
                width: 100%;
                height: 6px;
                background-color: #e0e0e0;
                border-radius: 3px;
                margin-top: 8px;
                overflow: hidden;
              "
            >
              <div
                id="progress-bar"
                style="
                  width: 0%;
                  height: 100%;
                  background-color: var(--primary);
                  transition: width 0.3s;
                "
              ></div>
            </div>
          </div>
          <div id="pdf-preview" class="pdf-preview" style="display: none">
            <!-- PDF preview will be inserted here -->
          </div>
        </div>

        <div class="dashboard-layout">
          <div class="column">
            <div class="card">
              <div class="card-title">Blood Pressure History</div>
              <div class="chart-legend">
                <div class="legend-item">
                  <div class="legend-color systolic"></div>
                  <span>Systolic</span>
                </div>
                <div class="legend-item">
                  <div class="legend-color diastolic"></div>
                  <span>Diastolic</span>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="bloodPressureChart"></canvas>
              </div>
            </div>

            <div class="vitals-grid">
              <div class="vital-card">
                <div class="vital-icon">ü´Å</div>
                <div class="vital-data">
                  <div class="vital-label">Respiratory Rate</div>
                  <div class="vital-value">20 bpm</div>
                  <div class="vital-status normal">Normal</div>
                </div>
              </div>
              <div class="vital-card">
                <div class="vital-icon">üå°Ô∏è</div>
                <div class="vital-data">
                  <div class="vital-label">Temperature</div>
                  <div class="vital-value">98.6¬∞F</div>
                  <div class="vital-status normal">Normal</div>
                </div>
              </div>
              <div class="vital-card">
                <div class="vital-icon">‚ù§Ô∏è</div>
                <div class="vital-data">
                  <div class="vital-label">Heart Rate</div>
                  <div class="vital-value">78 bpm</div>
                  <div class="vital-status warning">Lower than Average</div>
                </div>
              </div>
            </div>

            <div class="card">
              <div class="card-title">Diagnostic List</div>
              <table class="diagnostics-table">
                <thead>
                  <tr>
                    <th>Problem/Diagnosis</th>
                    <th>Description</th>
                    <th>Status</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Hypertension</td>
                    <td>Chronic high blood pressure</td>
                    <td>
                      <span class="status-pill status-observation"
                        >Under Observation</span
                      >
                    </td>
                  </tr>
                  <tr>
                    <td>Type 2 Diabetes</td>
                    <td>Insulin resistance and elevated blood glucose</td>
                    <td>
                      <span class="status-pill status-ongoing">Ongoing</span>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="column">
            <div class="card">
              <div class="empty-state" id="profile-empty-state">
                <div class="empty-state-icon">üë§</div>
                <div class="empty-state-text">No Patient Data</div>
                <div class="empty-state-subtext">
                  Upload a medical report to view patient details
                </div>
              </div>
              <div class="patient-profile" id="patient-profile">
                <div class="profile-avatar">üë©</div>
                <h2 class="profile-name"></h2>
                <div class="patient-details-list">
                  <div class="detail-item">
                    <div class="detail-icon">üìÖ</div>
                    <div class="detail-content">
                      <div class="detail-label">Date Of Birth</div>
                      <div class="detail-value"></div>
                    </div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-icon">‚öß</div>
                    <div class="detail-content">
                      <div class="detail-label">Gender</div>
                      <div class="detail-value"></div>
                    </div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-icon">üìû</div>
                    <div class="detail-content">
                      <div class="detail-label">Contact Info</div>
                      <div class="detail-value"></div>
                    </div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-icon">üö®</div>
                    <div class="detail-content">
                      <div class="detail-label">Emergency Contacts</div>
                      <div class="detail-value"></div>
                    </div>
                  </div>
                  <div class="detail-item">
                    <div class="detail-icon">üè•</div>
                    <div class="detail-content">
                      <div class="detail-label">Insurance Provider</div>
                      <div class="detail-value"></div>
                    </div>
                  </div>
                </div>
                <div class="show-all-btn">Show All Information</div>
              </div>
            </div>

            <div class="card">
              <div class="card-title">Lab Results</div>
              <div class="lab-results-list">
                <div class="lab-result-item">
                  <div class="lab-result-name">Blood Tests</div>
                  <div class="download-icon">‚¨áÔ∏è</div>
                </div>
                <div class="lab-result-item">
                  <div class="lab-result-name">CT Scans</div>
                  <div class="download-icon">‚¨áÔ∏è</div>
                </div>
                <div class="lab-result-item">
                  <div class="lab-result-name">Radiology Reports</div>
                  <div class="download-icon">‚¨áÔ∏è</div>
                </div>
                <div class="lab-result-item">
                  <div class="lab-result-name">X-Rays</div>
                  <div class="download-icon">‚¨áÔ∏è</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="notification" id="data-notification"></div>
    <script>
      // Set up PDF.js
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js";

      document.addEventListener("DOMContentLoaded", function () {
        const uploadInput = document.getElementById("pdf-upload");
        const uploadContainer = document.getElementById("upload-container");
        const uploadStatus = document.getElementById("upload-status");
        const progressBar = document.getElementById("progress-bar");
        const pdfPreview = document.getElementById("pdf-preview");
        const dataNotification = document.getElementById("data-notification");
        let myChart;

        // Initialize the blood pressure chart with zero values
        const ctx = document
          .getElementById("bloodPressureChart")
          .getContext("2d");
        myChart = new Chart(ctx, {
          type: "line",
          data: {
            labels: [
              "Jan",
              "Feb",
              "Mar",
              "Apr",
              "May",
              "Jun",
              "Jul",
              "Aug",
              "Sep",
              "Oct",
              "Nov",
              "Dec",
            ],
            datasets: [
              {
                label: "Systolic",
                data: Array(12).fill(0),
                borderColor: "#EC4899",
                backgroundColor: "rgba(236, 72, 153, 0.1)",
                fill: true,
                tension: 0.4,
                pointRadius: 4,
                pointHoverRadius: 6,
                borderWidth: 2,
                pointBackgroundColor: "#EC4899",
                pointBorderColor: "#FFF",
                pointBorderWidth: 2,
                pointHoverBackgroundColor: "#EC4899",
                pointHoverBorderColor: "#FFF",
                pointHoverBorderWidth: 3,
              },
              {
                label: "Diastolic",
                data: Array(12).fill(0),
                borderColor: "#F472B6",
                backgroundColor: "rgba(244, 114, 182, 0.1)",
                fill: true,
                tension: 0.4,
                pointRadius: 4,
                pointHoverRadius: 6,
                borderWidth: 2,
                pointBackgroundColor: "#F472B6",
                pointBorderColor: "#FFF",
                pointBorderWidth: 2,
                pointHoverBackgroundColor: "#F472B6",
                pointHoverBorderColor: "#FFF",
                pointHoverBorderWidth: 3,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              tooltip: {
                mode: "index",
                intersect: false,
                backgroundColor: "rgba(255, 255, 255, 0.9)",
                titleColor: "#1E293B",
                bodyColor: "#1E293B",
                borderColor: "#F9A8D4",
                borderWidth: 1,
                padding: 10,
                boxPadding: 5,
                usePointStyle: true,
                callbacks: {
                  label: function (context) {
                    return (
                      context.dataset.label + ": " + context.parsed.y + " mmHg"
                    );
                  },
                },
              },
              legend: {
                display: false,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                min: 0,
                max: 200,
                grid: {
                  color: "rgba(244, 114, 182, 0.1)",
                  drawBorder: false,
                },
                ticks: {
                  color: "#64748B",
                  font: {
                    size: 11,
                  },
                },
              },
              x: {
                grid: {
                  color: "rgba(244, 114, 182, 0.1)",
                  drawBorder: false,
                },
                ticks: {
                  color: "#64748B",
                  font: {
                    size: 11,
                  },
                },
              },
            },
            interaction: {
              intersect: false,
              mode: "index",
            },
          },
        });

        // Add drag and drop functionality
        uploadContainer.addEventListener("dragover", function (e) {
          e.preventDefault();
          uploadContainer.classList.add("dragover");
          uploadContainer.style.backgroundColor = "#f0f8ff";
          uploadContainer.style.borderColor = "var(--primary)";
        });

        uploadContainer.addEventListener("dragleave", function () {
          uploadContainer.classList.remove("dragover");
          uploadContainer.style.backgroundColor = "";
          uploadContainer.style.borderColor = "";
        });

        uploadContainer.addEventListener("drop", function (e) {
          e.preventDefault();
          uploadContainer.classList.remove("dragover");
          uploadContainer.style.backgroundColor = "";
          uploadContainer.style.borderColor = "";

          if (e.dataTransfer.files.length) {
            const file = e.dataTransfer.files[0];
            if (file.type === "application/pdf") {
              handlePdfFile(file);
            } else {
              alert("Please upload a PDF file.");
            }
          }
        });

        // Handle file selection through the input
        uploadInput.addEventListener("change", function () {
          const file = uploadInput.files[0];
          if (file) {
            if (file.type === "application/pdf") {
              handlePdfFile(file);
            } else {
              alert("Please upload a PDF file.");
              uploadInput.value = ""; // Clear the input
            }
          }
        });

        function handlePdfFile(file) {
          console.log("Processing PDF file:", file.name);
          uploadStatus.style.display = "block";
          progressBar.style.width = "0%";
          processPDF(file);
        }

        async function processPDF(file) {
          try {
            const loadingOverlay = document.createElement("div");
            loadingOverlay.className = "loading-overlay";
            loadingOverlay.innerHTML = `
        <div class="spinner"></div>
        <div class="loading-text">
          <h3>Processing Medical Report</h3>
          <p id="processing-status">Initializing document processing...</p>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar" id="processing-progress"></div>
        </div>
      `;
            document.body.appendChild(loadingOverlay);

            const progressBar = document.getElementById("processing-progress");
            const statusText = document.getElementById("processing-status");

            // Initialize PDF.js with progress updates
            progressBar.style.width = "10%";
            statusText.textContent = "Loading PDF document...";
            await new Promise((resolve) => setTimeout(resolve, 800));

            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;

            progressBar.style.width = "25%";
            statusText.textContent = "Analyzing document structure...";
            await new Promise((resolve) => setTimeout(resolve, 800));

            let extractedData = {
              patientInfo: {},
              vitals: {},
              diagnoses: [],
              labResults: [],
              medications: [],
              trends: {},
            };

            // Process pages with detailed progress
            const numPages = pdf.numPages;
            const pagePromises = [];

            progressBar.style.width = "40%";
            statusText.textContent = "Extracting medical information...";
            await new Promise((resolve) => setTimeout(resolve, 800));

            for (let i = 1; i <= numPages; i++) {
              pagePromises.push(processPage(pdf, i));
              progressBar.style.width = `${40 + (i / numPages) * 20}%`;
              statusText.textContent = `Processing page ${i} of ${numPages}...`;
              await new Promise((resolve) => setTimeout(resolve, 300));
            }

            const pageResults = await Promise.all(pagePromises);

            progressBar.style.width = "70%";
            statusText.textContent = "Consolidating medical data...";
            await new Promise((resolve) => setTimeout(resolve, 800));

            pageResults.forEach((result) => {
              mergeExtractedData(extractedData, result);
            });

            // Process the first page for preview
            progressBar.style.width = "80%";
            statusText.textContent = "Generating visual preview...";
            await new Promise((resolve) => setTimeout(resolve, 800));

            const firstPage = await pdf.getPage(1);
            const viewport = firstPage.getViewport({ scale: 1.5 });
            const canvas = document.createElement("canvas");
            canvas.className = "pdf-preview-canvas";
            canvas.width = viewport.width;
            canvas.height = viewport.height;

            const context = canvas.getContext("2d");
            await firstPage.render({
              canvasContext: context,
              viewport: viewport,
            }).promise;

            const previewContainer = document.getElementById("pdf-preview");
            previewContainer.innerHTML = "";
            previewContainer.appendChild(canvas);

            progressBar.style.width = "90%";
            statusText.textContent = "Processing medical analysis...";
            await new Promise((resolve) => setTimeout(resolve, 800));

            const processedData = await processExtractedData(extractedData);
            processedData.trends = calculateTrends(processedData);

            progressBar.style.width = "100%";
            statusText.textContent = "Finalizing dashboard updates...";
            await new Promise((resolve) => setTimeout(resolve, 800));

            setTimeout(() => {
              loadingOverlay.remove();
              updateDashboard(processedData);
              showSuccessNotification("Medical report processed successfully");
            }, 500);
          } catch (error) {
            console.error("Error processing PDF:", error);
            showErrorNotification(
              `Error processing document: ${error.message}`
            );
            document.querySelector(".loading-overlay")?.remove();
          }
        }

        async function processPage(pdf, pageNum) {
          const page = await pdf.getPage(pageNum);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map((item) => item.str).join(" ");

          return extractPageData(pageText, pageNum);
        }

        async function processExtractedData(data) {
          // Enhanced data processing with validation
          const processed = {
            patientInfo: validatePatientInfo(data.patientInfo),
            vitals: normalizeVitals(data.vitals),
            diagnoses: data.diagnoses,
            labResults: data.labResults || [], // Simply use the array or empty array if undefined
            medications: data.medications || [], // Simply use the array or empty array if undefined
            risk_levels: calculateRiskLevels(data.vitals),
            risk_distribution: calculateRiskDistribution(data.vitals),
          };

          return processed;
        }

        function validatePatientInfo(info) {
          return {
            name: info.patientName || "N/A",
            dob: info.dob || "N/A",
            gender: info.gender || "N/A",
            contact: info.contact || "N/A",
            emergency: info.emergency || "N/A",
          };
        }

        function normalizeVitals(vitals) {
          return {
            heartRate: vitals.heartRate || 0,
            respiratoryRate: vitals.respiratoryRate || 0,
            temperature: vitals.temperature?.value || 0,
            bloodPressure: vitals.bloodPressure || {
              systolic: 0,
              diastolic: 0,
            },
          };
        }

        function calculateRiskLevels(vitals) {
          const riskScores = {
            high: 0,
            mid: 0,
            low: 0,
          };

          // Calculate risk based on vital signs
          if (vitals.heartRate) {
            if (vitals.heartRate < 60 || vitals.heartRate > 100)
              riskScores.high++;
            else if (vitals.heartRate < 65 || vitals.heartRate > 95)
              riskScores.mid++;
            else riskScores.low++;
          }

          if (vitals.respiratoryRate) {
            if (vitals.respiratoryRate < 12 || vitals.respiratoryRate > 20)
              riskScores.high++;
            else if (vitals.respiratoryRate < 14 || vitals.respiratoryRate > 18)
              riskScores.mid++;
            else riskScores.low++;
          }

          return riskScores;
        }

        function calculateRiskDistribution(vitals) {
          const riskLevels = calculateRiskLevels(vitals);
          const total =
            Object.values(riskLevels).reduce((a, b) => a + b, 0) || 1;

          return {
            high: Math.round((riskLevels.high / total) * 100),
            mid: Math.round((riskLevels.mid / total) * 100),
            low: Math.round((riskLevels.low / total) * 100),
          };
        }

        function extractPageData(text, pageNum) {
          const data = {
            patientInfo: {},
            vitals: {},
            diagnoses: [],
            labResults: [],
            medications: [],
          };

          // Enhanced pattern matching for various data types
          const patterns = {
            patientName: /Patient(?:\s+Name)?:\s*([A-Za-z\.-]+)/i,
            dob: /(?:DOB|Date\s+of\s+Birth):\s*(\d{1,2}\/\d{1,2}\/\d{4}|\w+\s+\d{1,2},\s*\d{4})/i,
            gender: /(?:Gender|Sex):\s*([A-Za-z]+)/i,
            heartRate: /Heart\s+Rate:\s*(\d+)\s*(?:bpm|BPM)/i,
            bloodPressure:
              /(?:BP|Blood\s+Pressure):\s*(\d+)\/(\d+)\s*(?:mmHg)?/i,
            temperature: /(?:Temp|Temperature):\s*([\d\.]+)\s*[¬∞]?([CF])/i,
            respiratoryRate: /(?:RR|Respiratory\s+Rate):\s*(\d+)/i,
            height: /Height:\s*([\d\.]+)\s*(cm|in)/i,
            weight: /Weight:\s*([\d\.]+)\s*(kg|lbs)/i,
          };

          // Extract patient info
          Object.entries(patterns).forEach(([key, pattern]) => {
            const match = text.match(pattern);
            if (match) {
              if (key === "bloodPressure") {
                data.vitals[key] = {
                  systolic: parseInt(match[1]),
                  diastolic: parseInt(match[2]),
                };
              } else if (["heartRate", "respiratoryRate"].includes(key)) {
                data.vitals[key] = parseInt(match[1]);
              } else if (key === "temperature") {
                data.vitals[key] = {
                  value: parseFloat(match[1]),
                  unit: match[2],
                };
              } else {
                data.patientInfo[key] = match[1].trim();
              }
            }
          });

          // Extract diagnoses using more sophisticated pattern matching
          const diagnosisSection = text.match(
            /(?:Diagnosis|Assessment|Impression)s?:([^]*?)(?=\n\s*\n|\n[A-Z]|$)/i
          );
          if (diagnosisSection) {
            const diagnoses = diagnosisSection[1]
              .split(/[‚Ä¢\-\d+\.]/)
              .map((d) => d.trim())
              .filter((d) => d.length > 0 && d.length < 100);
            data.diagnoses = diagnoses;
          }

          // Extract lab results with values and units
          const labSection = text.match(
            /(?:Laboratory|Lab)\s+Results?:([^]*?)(?=\n\s*\n|\n[A-Z]|$)/i
          );
          if (labSection) {
            const labResults = labSection[1]
              .split("\n")
              .map((line) => {
                const match = line.match(
                  /([^:]+):\s*([\d\.]+)\s*([A-Za-z\/]+)?/
                );
                if (match) {
                  return {
                    test: match[1].trim(),
                    value: parseFloat(match[2]),
                    unit: match[3] || "",
                  };
                }
                return null;
              })
              .filter(Boolean);
            data.labResults = labResults;
          }

          return data;
        }

        function mergeExtractedData(target, source) {
          // Merge patient info
          Object.assign(target.patientInfo, source.patientInfo);

          // Merge vitals
          Object.assign(target.vitals, source.vitals);

          // Merge arrays
          target.diagnoses = [
            ...new Set([...target.diagnoses, ...source.diagnoses]),
          ];
          target.labResults = [...target.labResults, ...source.labResults];
          target.medications = [...target.medications, ...source.medications];
        }

        function calculateTrends(data) {
          // Calculate trends based on historical data
          const trends = {};

          // Example trend calculation for vitals
          if (data.vitals) {
            if (data.vitals.heartRate) {
              trends.heartRate = calculatePercentageChange(
                data.vitals.heartRate,
                75
              ); // baseline
            }
            if (data.vitals.respiratoryRate) {
              trends.respiratoryRate = calculatePercentageChange(
                data.vitals.respiratoryRate,
                16
              );
            }
            if (data.vitals.temperature?.value) {
              trends.temperature = calculatePercentageChange(
                data.vitals.temperature.value,
                98.6
              );
            }
          }

          return trends;
        }

        function calculatePercentageChange(current, baseline) {
          return Math.round(((current - baseline) / baseline) * 100);
        }

        function showSuccessNotification(message) {
          const notification = document.getElementById("data-notification");
          notification.className = "notification success";
          notification.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7" />
      </svg>
      ${message}
    `;
          notification.classList.add("show");
          setTimeout(() => {
            notification.classList.remove("show");
          }, 3000);
        }

        function showErrorNotification(message) {
          const notification = document.getElementById("data-notification");
          notification.className = "notification error";
          notification.innerHTML = `
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M6 18L18 6M6 6l12 12" />
      </svg>
      ${message}
    `;
          notification.classList.add("show");
          setTimeout(() => {
            notification.classList.remove("show");
          }, 3000);
        }

        function updateDashboard(data) {
          // Add loading animation with spinner and progress
          const loadingOverlay = document.createElement("div");
          loadingOverlay.className = "loading-overlay";
          loadingOverlay.innerHTML = `
      <div class="spinner"></div>
      <div class="loading-text">
        <h3>Updating Dashboard</h3>
        <p id="update-status">Processing vital signs...</p>
      </div>
      <div class="progress-bar-container">
        <div class="progress-bar" id="update-progress"></div>
      </div>
    `;
          document.body.appendChild(loadingOverlay);

          const progressBar = loadingOverlay.querySelector(".progress-bar");
          const statusText = loadingOverlay.querySelector("#update-status");

          // Update sequence with proper progress tracking and error handling
          try {
            // Update vital signs
            progressBar.style.width = "25%";
            statusText.textContent = "Updating vital signs...";
            updateVitalSigns(data.vitals);

            // Update patient info
            progressBar.style.width = "50%";
            statusText.textContent = "Updating patient information...";
            if (data.patientInfo) {
              updatePatientInfo(data.patientInfo);
            }

            // Update risk levels
            progressBar.style.width = "75%";
            statusText.textContent = "Calculating risk levels...";
            if (data.risk_levels) {
              updateRiskLevelInfo(data.risk_levels);
            }

            // Update charts and finalize
            progressBar.style.width = "100%";
            statusText.textContent = "Finalizing updates...";

            if (data.risk_distribution) {
              updateRiskDistributionChart(data.risk_distribution);
            }
            if (data.trends) {
              addTrendIndicators(data.trends);
            }

            // Show success notification
            showSuccessNotification("Dashboard updated successfully");

            // Remove loading overlay
            setTimeout(() => {
              loadingOverlay.remove();
            }, 500);
          } catch (error) {
            console.error("Error updating dashboard:", error);
            showErrorNotification("Error updating dashboard: " + error.message);
            loadingOverlay.remove();
          }
        }

        function updateVitalSigns(vitals) {
          if (!vitals) return;

          const vitalCards = document.querySelectorAll(".vital-card");
          vitalCards.forEach((card) => {
            const label = card.querySelector(".vital-label").textContent;
            const valueElement = card.querySelector(".vital-value");
            const statusElement = card.querySelector(".vital-status");

            let value = null;
            let unit = "";
            let status = "normal";

            if (label.includes("Respiratory")) {
              value = vitals.respiratoryRate;
              unit = " bpm";
              status = value < 12 || value > 20 ? "warning" : "normal";
            } else if (label.includes("Temperature")) {
              value = vitals.temperature?.value;
              unit = "¬∞" + (vitals.temperature?.unit || "F");
              status = value < 97.7 || value > 99.5 ? "warning" : "normal";
            } else if (label.includes("Heart")) {
              value = vitals.heartRate;
              unit = " bpm";
              status = value < 60 || value > 100 ? "warning" : "normal";
            }

            if (value !== null) {
              animateNumber(valueElement, value, unit);
              statusElement.className = `vital-status ${status}`;
              statusElement.textContent =
                status === "normal" ? "Normal" : "Abnormal";
            }
          });
        }

        function animateNumber(element, targetValue, unit = "") {
          if (!element || targetValue === null) return;

          const startValue = parseInt(element.textContent) || 0;
          const duration = 1000;
          const startTime = performance.now();

          function update(currentTime) {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);

            const currentValue = Math.round(
              startValue + (targetValue - startValue) * progress
            );
            element.textContent = currentValue + unit;

            if (progress < 1) {
              requestAnimationFrame(update);
            }
          }

          requestAnimationFrame(update);
        }

        function updatePatientInfo(patientInfo) {
          const profileEmptyState = document.getElementById(
            "profile-empty-state"
          );
          const patientProfile = document.getElementById("patient-profile");
          const headerUserName = document.getElementById("header-user-name");

          // Hide empty state
          profileEmptyState.style.display = "none";

          // Show and populate patient profile
          patientProfile.style.display = "block";
          setTimeout(() => {
            patientProfile.classList.add("show");
          }, 100);

          // Update header user name
          headerUserName.textContent = patientInfo.name || "N/A";
          headerUserName.classList.add("show");

          // Update profile information
          const profileName = patientProfile.querySelector(".profile-name");
          const detailValues = patientProfile.querySelectorAll(".detail-value");

          profileName.textContent = patientInfo.name || "N/A";

          const details = [
            patientInfo.dob || "N/A",
            patientInfo.gender || "N/A",
            patientInfo.contact || "N/A",
            patientInfo.emergency || "N/A",
            patientInfo.insurance || "Sunrise Health Assurance",
          ];

          detailValues.forEach((element, index) => {
            element.textContent = details[index];
            element.style.animation = "fadeIn 0.5s ease-in-out";
          });
        }

        function addTrendIndicators(trends) {
          if (!trends) return;

          const cards = document.querySelectorAll(".info-card");
          cards.forEach((card) => {
            const title = card.querySelector("h3").textContent.toLowerCase();
            if (trends[title]) {
              const indicator = document.createElement("div");
              indicator.className = `trend-indicator ${
                trends[title] > 0 ? "up" : "down"
              }`;
              indicator.innerHTML = `
          <i class="fas fa-${
            trends[title] > 0 ? "arrow-up" : "arrow-down"
          }"></i>
          <span>${Math.abs(trends[title])}%</span>
        `;
              card.appendChild(indicator);
            }
          });
        }

        function updateRiskLevelInfo(riskLevels) {
          if (!riskLevels) return;

          // Update the diagnostics table with risk levels
          const diagnosticsTable = document.querySelector(
            ".diagnostics-table tbody"
          );
          if (!diagnosticsTable) return;

          // Clear existing rows
          diagnosticsTable.innerHTML = "";

          // Add risk level rows
          if (riskLevels.high > 0) {
            addDiagnosticRow(
              diagnosticsTable,
              "High Risk Indicators",
              "Multiple vital signs outside normal range",
              "danger"
            );
          }
          if (riskLevels.mid > 0) {
            addDiagnosticRow(
              diagnosticsTable,
              "Moderate Risk Indicators",
              "Some vital signs slightly abnormal",
              "observation"
            );
          }
          if (riskLevels.low > 0) {
            addDiagnosticRow(
              diagnosticsTable,
              "Normal Indicators",
              "Vital signs within normal range",
              "ongoing"
            );
          }
        }

        function addDiagnosticRow(table, diagnosis, description, status) {
          const row = document.createElement("tr");
          row.innerHTML = `
      <td>${diagnosis}</td>
      <td>${description}</td>
      <td><span class="status-pill status-${status}">${
            status === "danger"
              ? "High Risk"
              : status === "observation"
              ? "Under Observation"
              : "Normal"
          }</span></td>
    `;
          table.appendChild(row);
        }

        function updateRiskDistributionChart(distribution) {
          if (!distribution || !myChart) return;

          // Update the blood pressure chart with new data
          const months = myChart.data.labels.length;
          const systolicBase = distribution.high
            ? 140
            : distribution.mid
            ? 130
            : 120;
          const diastolicBase = distribution.high
            ? 90
            : distribution.mid
            ? 85
            : 80;

          // Generate slightly varying data based on risk distribution
          const systolicData = Array(months)
            .fill(0)
            .map(() => systolicBase + Math.random() * 10 - 5);
          const diastolicData = Array(months)
            .fill(0)
            .map(() => diastolicBase + Math.random() * 10 - 5);

          // Animate the chart update
          const animation = {
            duration: 800,
            easing: "easeInOutQuart",
          };

          myChart.data.datasets[0].data = systolicData;
          myChart.data.datasets[1].data = diastolicData;
          myChart.update("active", animation);
        }
      });
    </script>
  </body>
</html>